import{V as e,W as s,X as o,Y as t,m as a,l as r}from"./index-xJ6XffpG.js";const c="https://clifikqzwwps.sealoshzh.site/api",l="app-gY716lkSIyQTX7h1bW2XDcti",n=s=>new Promise(((t,a)=>{const r=s.url.startsWith("http")?s.url:`${c}${s.url}`,n=s.header||{};if(n["X-API-Key"]=l,!1!==s.auth){const o=e();o?n.Authorization=`Bearer ${o}`:console.warn("请求需要认证但没有找到token",s.url)}console.log("发起请求:",r,s.method||"GET");const i=o({url:r,data:s.data,method:s.method||"GET",header:n,timeout:s.timeout||3e4,success:e=>{console.log("请求响应:",r,e.statusCode),e.statusCode>=200&&e.statusCode<300?200===e.data.code?t(e.data):d(e.data,a):401===e.statusCode?(console.warn("收到401未授权响应：",r),g(),a({code:401,message:"未授权或登录过期，请重新登录"})):404===e.statusCode?(console.warn("请求的资源不存在:",r),a({code:404,message:"请求的资源不存在",url:r})):a({code:e.statusCode,message:`请求失败: ${e.statusCode}`})},fail:e=>{console.error("请求错误:",r,e),e.errMsg&&e.errMsg.includes("timeout")?a({code:-1,message:"请求超时，服务器响应时间过长",isTimeout:!0}):a({code:-1,message:"网络错误，请检查网络连接",isNetworkError:!0})}});s.getTask&&s.getTask(i)})),d=(e,s)=>{switch(e.code){case 400:s({code:400,message:e.message||"请求参数错误",errors:e.errors});break;case 401:g(),s({code:401,message:"未授权或登录过期，请重新登录"});break;case 403:s({code:403,message:"权限不足，无法访问"});break;case 404:s({code:404,message:"请求的资源不存在"});break;case 500:s({code:500,message:"服务器内部错误，请稍后再试"});break;default:s({code:e.code||-1,message:e.message||"未知错误"})}},g=()=>{try{const{clearUserData:e}=require("./storage.js");e();const s=t(),o=s[s.length-1];o&&!o.route.includes("login")&&(console.log("检测到未授权状态，准备跳转到登录页面"),setTimeout((()=>{a({url:"/pages/login/login",success:()=>{console.log("已成功跳转到登录页面")},fail:e=>{console.error("跳转到登录页面失败:",e);try{{const e=location.origin+location.pathname;window.location.href=e+"#/pages/login/login"}}catch(s){console.error("所有跳转尝试都失败:",s)}}})}),100))}catch(e){console.error("处理未授权错误:",e)}},i={get:(e,s,o={})=>n({url:e,method:"GET",data:s,...o}),post:(e,s,o={})=>n({url:e,method:"POST",data:s,...o}),put:(e,s,o={})=>n({url:e,method:"PUT",data:s,...o}),delete:(e,s,o={})=>n({url:e,method:"DELETE",data:s,...o}),upload:(o,t,a={},r={})=>new Promise(((n,g)=>{const i=e(),m=r.header||{};m["X-API-Key"]=l,i&&(m.Authorization=`Bearer ${i}`),console.log("开始上传文件:",o,"文件路径:",t);const u=o.startsWith("http")?o:`${c}${o}`;console.log("完整上传URL:",u);const h=s({url:u,filePath:t,name:r.name||"file",formData:a,header:m,timeout:r.timeout||3e4,success:e=>{console.log("上传响应:",e);try{const s=JSON.parse(e.data);200===s.code?n(s):d(s,g)}catch(s){console.error("响应解析失败:",s,e),g({code:-1,message:"解析响应失败: "+(s.message||"未知错误")})}},fail:e=>{console.error("上传失败详情:",e),e.errMsg&&e.errMsg.includes("timeout")?g({code:-1,message:"上传超时，服务器响应时间过长",isTimeout:!0}):e.errMsg&&e.errMsg.includes("fail connect")?g({code:-1,message:"无法连接到服务器，请检查网络或服务器状态",isConnectionError:!0}):g({code:-1,message:"上传失败: "+(e.errMsg||"未知错误"),isNetworkError:!0})}});h.onProgressUpdate((e=>{console.log("上传进度:",e.progress),r.onProgress&&r.onProgress(e.progress)})),r.getTask&&r.getTask(h)}))};export{i as h};
