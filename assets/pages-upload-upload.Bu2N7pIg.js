import{r as e,c as a,A as s,a as l,w as t,i as o,o as c,b as u,S as i,g,d as r,e as n,f as I,t as C,x as A,h as Q,B as E,C as S,s as f,D as d,E as p,m as B}from"./index-xJ6XffpG.js";import{o as k}from"./uni-app.es.WGLDDGg_.js";import{P as v}from"./PageHeader.BEnvkDdC.js";import{u as h,g as T}from"./paper.CyxWibfi.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./IconImage.CFxWE55B.js";import"./request.DmWrvmgp.js";const x=m({__name:"upload",setup(m){const x=e(!1),F=e({name:"",size:0,path:""}),K=e(!1),L=e(0),w=e(""),H=e(!1),R=e(""),j=e(null),G=()=>{S({count:1,extension:[".pdf",".doc",".docx",".txt"],success:e=>{console.log("文件选择成功:",e);const a=e.tempFilePaths[0],s=a.substring(a.lastIndexOf("/")+1);F.value={name:s,path:a,size:e.tempFiles[0].size},x.value=!0,f({title:"文件选择成功",icon:"success"})},fail:e=>{console.error("选择文件失败",e),"chooseFile:fail cancel"!==e.errMsg&&f({title:"选择文件失败",icon:"none"})}})},M=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},J=a((()=>x.value)),U=()=>{F.value.path?(d({title:"处理中...",mask:!0}),K.value=!0,L.value=0,w.value="文件上传中...",console.log("准备上传文件:",F.value),h(F.value).then((e=>{if(console.log("文件上传成功:",e),H.value=!0,L.value=40,w.value="分析论文中...",!e.data||!e.data.paperId)throw new Error("未获取到有效的文件ID");R.value=e.data.paperId,console.log("获取到文件ID:",R.value),O(R.value),p()})).catch((e=>{console.error("文件上传失败:",e),K.value=!1,p(),f({title:"上传失败，请重试",icon:"none"})}))):f({title:"请先选择文件",icon:"none"})},O=e=>{j.value&&clearInterval(j.value),j.value=setInterval((()=>{y(e)}),3e3)},y=e=>{T(e).then((a=>{console.log("论文处理状态:",a);const{status:s,progress:l}=a.data;switch(void 0!==l&&(L.value=40+Math.floor(.6*l)),s){case"processing":w.value="正在分析论文...";break;case"completed":clearInterval(j.value),L.value=100,w.value="分析完成",setTimeout((()=>{B({url:`/pages/analysis/analysis?fileId=${e}`})}),1e3);break;case"failed":clearInterval(j.value),K.value=!1,f({title:"分析失败，请重试",icon:"none"})}})).catch((a=>{console.error("检查状态失败:",a),404===a.code&&(console.log("状态检查接口不存在，尝试直接跳转到分析页面"),L.value+=10,L.value>=100&&(clearInterval(j.value),w.value="分析完成",setTimeout((()=>{B({url:`/pages/analysis/analysis?fileId=${e}`})}),1e3)))}))};return s((()=>{j.value&&clearInterval(j.value)})),k((()=>{console.log("上传页面加载完成")})),(e,a)=>{const s=r,S=o,f=n,d=i,p=Q;return c(),l(S,{class:"upload-container"},{default:t((()=>[u(v,{title:"上传文件"}),u(d,{"scroll-y":"",class:"content"},{default:t((()=>[u(S,{class:"upload-area animate-fade",onClick:G},{default:t((()=>[u(S,{class:"upload-icon-wrapper"},{default:t((()=>[u(s,{src:"data:image/png;base64,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",class:"icon-large",mode:"aspectFit"})])),_:1}),u(f,{class:"upload-text"},{default:t((()=>[I(C(x.value?F.value.name:"点击上传文件"),1)])),_:1}),x.value?(c(),l(f,{key:1,class:"file-size"},{default:t((()=>[I(C(M(F.value.size)),1)])),_:1})):(c(),l(f,{key:0,class:"upload-desc"},{default:t((()=>[I("支持 PDF、DOC、DOCX、TXT 格式")])),_:1})),H.value?(c(),l(f,{key:2,class:"upload-success"},{default:t((()=>[I("✓ 上传成功")])),_:1})):g("",!0)])),_:1}),u(S,{class:"feature-section animate-fade"},{default:t((()=>[u(S,{class:"section-header"},{default:t((()=>[u(f,{class:"section-title"},{default:t((()=>[I("论文分析功能")])),_:1})])),_:1}),u(S,{class:"feature-card"},{default:t((()=>[u(S,{class:"feature-icon"},{default:t((()=>[u(s,{src:"/keyanzhushou/assets/model-J5Bepfte.png",class:"icon-medium",mode:"aspectFit"})])),_:1}),u(S,{class:"feature-content"},{default:t((()=>[u(f,{class:"feature-text"},{default:t((()=>[I("智能论文分析")])),_:1}),u(f,{class:"feature-desc"},{default:t((()=>[I("AI将自动分析您上传的PDF论文，提取文章要点，整理文章思路，分析研究方向，生成研究模型图，结果可保存查看")])),_:1})])),_:1})])),_:1})])),_:1}),K.value?(c(),l(S,{key:0,class:"progress-section animate-fade"},{default:t((()=>[u(S,{class:"progress-header"},{default:t((()=>[u(f,{class:"progress-title"},{default:t((()=>[I("分析进度")])),_:1}),u(f,{class:"progress-percent"},{default:t((()=>[I(C(L.value)+"%",1)])),_:1})])),_:1}),u(S,{class:"progress-bar"},{default:t((()=>[u(S,{class:"progress-inner",style:A({width:L.value+"%"})},null,8,["style"])])),_:1}),u(f,{class:"progress-step"},{default:t((()=>[I(C(w.value),1)])),_:1})])),_:1})):g("",!0),u(S,{class:"bottom-space"})])),_:1}),u(S,{class:"fixed-bottom-btn"},{default:t((()=>[u(p,{class:E(["start-btn",{"btn-active":J.value}]),onClick:U,disabled:!J.value||K.value},{default:t((()=>[K.value?(c(),l(S,{key:1,class:"loading-spinner"})):(c(),l(f,{key:0},{default:t((()=>[I("开始分析")])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1})}}},[["__scopeId","data-v-65d10258"]]);export{x as default};
