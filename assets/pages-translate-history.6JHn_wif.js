import{r as a,P as e,a as t,w as l,H as s,s as r,i as u,o,b as n,B as c,e as i,f as d,d as f,t as v,h as _,G as m,S as h,u as p,F as g,v as y,n as k}from"./index-xJ6XffpG.js";import{_ as b,a as x,b as C}from"./right.rGMJBKf1.js";import{b as $,c as j}from"./uni-app.es.WGLDDGg_.js";import{P as F}from"./PageHeader.BEnvkDdC.js";import{h as w}from"./request.DmWrvmgp.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./IconImage.CFxWE55B.js";const M=(a=1,e=10,t="all")=>w.get("/translate/history",{params:{page:a,size:e,style:t}}),z=S({__name:"history",setup(w){const S=a([]),z=a(1),D=a(10),I=a(!0),P=a(!0),T=a(!1),H=a("加载失败，请重试"),L=a("all"),q=(a,e)=>{const t={zh:"中文",en:"英文"};return`${t[a]||a} → ${t[e]||e}`},B=a=>{if(!a)return"";const e=new Date(a),t=new Date-e;if(t<36e5){const a=Math.floor(t/6e4);return a<=5?"刚刚":`${a}分钟前`}if(t<864e5){return`${Math.floor(t/36e5)}小时前`}if(t<2592e6){return`${Math.floor(t/864e5)}天前`}return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},G=a=>{L.value!==a&&(L.value=a,z.value=1,Y())},Y=()=>{P.value=!0,T.value=!1,z.value=1,M(z.value,D.value,L.value).then((a=>{a.data&&a.data.translations?(S.value=a.data.translations,I.value=S.value.length<a.data.total):(S.value=[],I.value=!1)})).catch((a=>{console.error("获取翻译历史失败:",a),T.value=!0,H.value="获取历史记录失败，请重试"})).finally((()=>{P.value=!1,s()}))},A=()=>{I.value&&!P.value&&(P.value=!0,z.value+=1,M(z.value,D.value,L.value).then((a=>{a.data&&a.data.translations&&a.data.translations.length>0?(S.value=[...S.value,...a.data.translations],I.value=S.value.length<a.data.total):I.value=!1})).catch((a=>{console.error("加载更多历史记录失败:",a),z.value-=1,r({title:"加载失败，请重试",icon:"none"})})).finally((()=>{P.value=!1})))},E=()=>{k({url:"/pages/translate/translate"})};return $((()=>{Y()})),e((()=>{Y()})),j((()=>{I.value&&A()})),(a,e)=>{const s=i,r=u,$=f,j=_,w=h;return o(),t(r,{class:"history-container"},{default:l((()=>[n(F,{title:"翻译历史"}),n(r,{class:"filter-bar"},{default:l((()=>[n(r,{class:c(["filter-item",{active:"all"===L.value}]),onClick:e[0]||(e[0]=a=>G("all"))},{default:l((()=>[n(s,null,{default:l((()=>[d("全部")])),_:1})])),_:1},8,["class"]),n(r,{class:c(["filter-item",{active:"academic"===L.value}]),onClick:e[1]||(e[1]=a=>G("academic"))},{default:l((()=>[n(s,null,{default:l((()=>[d("学术版")])),_:1})])),_:1},8,["class"]),n(r,{class:c(["filter-item",{active:"casual"===L.value}]),onClick:e[2]||(e[2]=a=>G("casual"))},{default:l((()=>[n(s,null,{default:l((()=>[d("普通版")])),_:1})])),_:1},8,["class"])])),_:1}),P.value?(o(),t(r,{key:0,class:"loading-container"},{default:l((()=>[n(r,{class:"loading-spinner"}),n(s,{class:"loading-text"},{default:l((()=>[d("加载历史记录中...")])),_:1})])),_:1})):T.value?(o(),t(r,{key:1,class:"error-container",onClick:Y},{default:l((()=>[n($,{src:b,class:"icon-large",mode:"aspectFit"}),n(s,{class:"error-title"},{default:l((()=>[d(v(H.value),1)])),_:1}),n(s,{class:"error-subtitle"},{default:l((()=>[d("点击重试")])),_:1}),n(j,{class:"retry-btn",onClick:m(Y,["stop"])},{default:l((()=>[d("重新加载")])),_:1})])),_:1})):0===S.value.length?(o(),t(r,{key:2,class:"empty-container"},{default:l((()=>[n($,{src:x,class:"icon-large",mode:"aspectFit"}),n(s,{class:"empty-title"},{default:l((()=>[d("暂无翻译记录")])),_:1}),n(s,{class:"empty-subtitle"},{default:l((()=>[d("返回翻译页面开始使用")])),_:1}),n(j,{class:"translate-btn",onClick:E},{default:l((()=>[d("开始翻译")])),_:1})])),_:1})):(o(),t(w,{key:3,"scroll-y":"",class:"history-content"},{default:l((()=>[(o(!0),p(g,null,y(S.value,(a=>(o(),t(r,{key:a.id,class:"history-item",onClick:e=>{return t=a.id,void k({url:`/pages/translate-result/translate-result?id=${t}`});var t}},{default:l((()=>[n(r,{class:"history-icon"},{default:l((()=>[n($,{src:"/keyanzhushou/static/icons/translate.png",class:"icon-medium",mode:"aspectFit"})])),_:1}),n(r,{class:"history-detail"},{default:l((()=>[n(r,{class:"history-header"},{default:l((()=>[n(s,{class:"history-title"},{default:l((()=>[d(v(q(a.sourceLanguage,a.targetLanguage)),1)])),_:2},1024),n(s,{class:"history-time"},{default:l((()=>[d(v(B(a.timestamp)),1)])),_:2},1024)])),_:2},1024),n(r,{class:"history-preview"},{default:l((()=>[n(s,{class:c(["preview-text",{"long-text":a.sourceText&&a.sourceText.length>50}])},{default:l((()=>[d(v(a.sourceText),1)])),_:2},1032,["class"])])),_:2},1024),n(r,{class:"history-tags"},{default:l((()=>[n(s,{class:"history-tag"},{default:l((()=>[d(v("academic"===a.style?"学术版":"普通版"),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(r,{class:"history-action"},{default:l((()=>[n($,{src:C,class:"icon-small",mode:"aspectFit"})])),_:1})])),_:2},1032,["onClick"])))),128)),I.value?(o(),t(r,{key:0,class:"load-more",onClick:A},{default:l((()=>[n(s,null,{default:l((()=>[d("加载更多")])),_:1})])),_:1})):(o(),t(r,{key:1,class:"no-more"},{default:l((()=>[n(s,null,{default:l((()=>[d("没有更多记录了")])),_:1})])),_:1})),n(r,{class:"bottom-space"})])),_:1}))])),_:1})}}},[["__scopeId","data-v-1f9a498e"]]);export{z as default};
